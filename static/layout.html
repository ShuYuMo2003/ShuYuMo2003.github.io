<!-- Academic Blog Template
MIT License - Copyright (c) 2025 Su Jiayi <sujiayi2003@gmail.com>
-->

<!DOCTYPE html>
<html lang="{{ lang }}">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        
        <!-- Primary Meta Tags -->
        <title>{{ site_title }}</title>
        <meta name="description" content="{{ description }}">
        <meta name="keywords" content="{{ keywords | join(', ') }}">
        <meta name="author" content="Su Jiayi">
        
        <!-- Open Graph Meta Tags -->
        <meta property="og:type" content="website">
        <meta property="og:title" content="{{ site_title }}">
        <meta property="og:description" content="{{ description }}">
        <meta property="og:image" content="../static/{{ header_path }}">
        
        <!-- Stylesheets -->
        <link rel="stylesheet" type="text/css" href="../static/css/default.css">
        <link rel="stylesheet" type="text/css" href="../static/css/syntax.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
        
        <!-- Google Analytics -->
        {% if google_analysis_id %}
        <script async src="https://www.googletagmanager.com/gtag/js?id={{ google_analysis_id }}"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', '{{ google_analysis_id }}');
        </script>
        {% endif %}
    </head>
    <body>
        <!-- Skip to main content for accessibility -->
        <a href="#main-content" class="skip-link">Skip to main content</a>
        
        <div id="main">
            <div class="main-container">
                <!-- Header -->
                <header id="header">
                    <div class="header-content">
                        <h1 class="header-title">
                            <a href="./">{{ header_desc }}</a>
                        </h1>
                        <p class="header-subtitle">{{ description }}</p>
                        <div class="header-accent"></div>
                    </div>
                </header>
                
                <!-- Content Layout -->
                <div class="content-wrapper">
                    <!-- Sidebar -->
                    <nav id="sidebar">
                        <div class="profile-section">
                            <a href="./" class="profile-avatar-link">
                                <img src="../static/{{ header_path }}" alt="{{ header_alt }}" class="profile-avatar" loading="lazy" />
                            </a>
                            <div class="profile-info">
                                <h3 class="profile-name">{{ author }}</h3>
            </div>
            </div>

                        <div class="nav-header">
                            <h2>üß≠ Navigation</h2>
                            <span class="nav-subtitle">Explore the site</span>
                        </div>
                        <nav class="nav-menu">
                            {% for n in nav_list %}
                            {% set is_active = (current_page == n.name.lower()) %}
                            <a href="{{ n.path }}" 
                               {% if n.blank %}target="_blank" rel="noopener"{% endif %}
                               class="nav-item{% if is_active %} nav-item-active{% endif %}">
                                <span class="nav-icon">üìÑ</span>
                                <span class="nav-text">{{ n.name }}</span>
                                {% if n.blank %}
                                    <span class="external-icon">üîó</span>
                                {% endif %}
                            </a>
                            {% endfor %}
                        </nav>
                    </nav>

                    <!-- Main Content -->
                    <main id="content">
                        <div id="main-content">
                            {% if is_post_page %}
                                <article>
                                    <!-- Article Header with Title and Actions -->
                                    <div class="article-header">
                                        <div class="article-title-section">
                                            {% if post_title %}
                                                <h1 class="article-title">{{ post_title }}</h1>
                                            {% endif %}
                                            
                                            <!-- Article Meta Information -->
                                            <div class="article-meta">
                                                {% if post_last_updated %}
                                                    <div class="meta-item">
                                                        <span class="meta-icon">üìÖ</span>
                                                        <span class="meta-label">Last Updated: </span>
                                                        <span class="meta-value">{{ post_last_updated }}</span>
                                                    </div>
                                                {% endif %}
                                                
                                                {% if post_word_count %}
                                                    <div class="meta-item">
                                                        <span class="meta-icon">üìä</span>
                                                        <span class="meta-label">Word Count: </span>
                                                        <span class="meta-value">{{ post_word_count }}</span>
                                                    </div>
                    {% endif %}

                                                {% if post_reading_time %}
                                                    <div class="meta-item">
                                                        <span class="meta-icon">‚è±Ô∏è</span>
                                                        <span class="meta-label">Estimated Reading Time: </span>
                                                        <span class="meta-value">{{ post_reading_time }} minutes</span>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <div class="article-actions">
                    {% if post_pdf_path %}
                                                <a href="{{ post_pdf_path }}" 
                                                   target="_blank" 
                                                   rel="noopener"
                                                   class="action-btn pdf-btn">
                                                    üìÑ PDF
                                                </a>
                                            {% endif %}
                                            
                                            {% if post_source_path %}
                                                <a href="{{ post_source_path }}" 
                                                   target="_blank" 
                                                   rel="noopener"
                                                   class="action-btn source-btn">
                                                    üìù Source
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <!-- Article Content -->
                                    <div class="article-content">
                                        {{ post_content | safe }}
                                    </div>

                                    <!-- Article Footer -->
                                    <div class="article-footer">
                                                                            {% if post_history %}
                                        <section class="post-history">
                                            <div class="history-header">
                                                <h2>üìö Version History</h2>
                                                <span class="history-desc">Source Code Change History</span>
                                            </div>
                                            <div class="version-list">
                                                {% for h in post_history %}
                                                    <div class="version-item">
                                                        <div class="version-header">
                                                            <span class="version-badge">v{{ loop.index }}</span>
                                                            <time class="version-time" datetime="{{ h.datetime }}">
                                                                üìÖ {{ h.datetime }}
                                                            </time>
                                                        </div>
                                                        <div class="version-hash-container">
                                                            <span class="hash-label">üîó Source Hash:</span>
                                                            <code class="version-hash" title="Source Code Hash ({{ h.hash }})">{{ h.hash }}</code>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </section>
                    {% endif %}

                    {% if post_formal_logs %}
                                            <details class="build-logs">
                                                <summary>Build Logs</summary>
                                                <pre class="logs-content">{{ post_formal_logs | safe }}</pre>
                                            </details>
                    {% endif %}
                                    </div>
                                </article>
                {% endif %}

                {% if is_category_page %}
                                <section>
                                    <h1>{{ category_name }}</h1>
                                    <div class="posts-grid">
                        {% for post in category_posts %}
                                            <article class="post-card">
                                                <h2>
                                                    <a href="{{ post.path }}">{{ post.title }}</a>
                                                </h2>
                                            </article>
                        {% endfor %}
                                    </div>
                                </section>
                {% endif %}

                {% if is_category_total_page %}
                                <section>
                                    <h1>All Categories</h1>
                                    <div class="categories-grid">
                        {% for category in category_list %}
                                            <article class="category-card">
                                                <h2>
                                                    <a href="{{ category.path }}">{{ category.title }}</a>
                                                </h2>
                                            </article>
                        {% endfor %}
                                    </div>
                                </section>
                {% endif %}

                {% if is_post_total_page %}
                <section>
                    <h1>Recent Posts</h1>
                    <p class="section-subtitle">Latest updates and insights</p>
                    
                    <div class="recent-posts-container">
                        {% for post in post_list[:10] %}
                            <article class="recent-post-item">
                                <div class="post-content">
                                    <h3>
                                        <a href="{{ post.path }}">{{ post.title }}</a>
                                    </h3>
                                    {% if post.abstract %}
                                        <p class="post-abstract">{{ post.abstract }}</p>
                                    {% endif %}
                                    <div class="post-meta-simple">
                                        <span class="post-full-date">{{ post.full_date }}</span>
                                        <span class="post-weekday">{{ post.weekday }}</span>
                                    </div>
                                </div>
                            </article>
                        {% endfor %}
                    </div>
                    
                    <div class="view-more">
                        <a href="./_archive.html" class="view-more-btn">
                            üìö View All Posts in Archive
                        </a>
                    </div>
                </section>
            {% endif %}

            {% if is_archive_page %}
                <section>
                    <h1>üìö Post Archive</h1>
                    <p class="section-subtitle">Complete chronological listing of all posts with detailed information</p>
                    
                    {% set post_groups = archive_post_list | groupby('year') %}
                    {% for year, posts in post_groups %}
                        <div class="archive-year-section">
                            <h2 class="archive-year-header">
                                <span class="year-number">{{ year }}</span>
                                <span class="post-count">({{ posts | length }} posts)</span>
                            </h2>
                            
                            <div class="archive-posts-list">
                                {% for post in posts %}
                                    <article class="archive-post-item">
                                        <div class="archive-post-content">
                                            <div class="archive-post-header">
                                                <h3 class="archive-post-title">
                                                    <a href="{{ post.path }}">{{ post.title }}</a>
                                                </h3>
                                                <span class="archive-post-date">üìÖ {{ post.full_date }}</span>
                                            </div>
                                        </div>
                                        
                                        <div class="archive-actions">
                                            <a href="{{ post.path }}" class="archive-read-btn">
                                                üìñ Read Article
                                            </a>
                                        </div>
                                    </article>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </section>
                {% endif %}

                {% if is_about_page %}
                                <article>
                    {{ about_page_content | safe }}
                                </article>
                {% endif %}
                        </div>
                    </main>
            </div>

                <!-- Footer -->
                <footer id="footer">
                    <p>{{ footer | safe }}</p>  Powered by <b>MonoPy</b> - Single-Script Blog Generator in Python.
                </footer>
            </div>
        </div>
        
        <!-- Back to top button -->
        <button id="back-to-top" 
                aria-label="Back to top" 
                title="Back to top"
                style="display: none;">
            ‚Üë
        </button>
        
        <!-- JavaScript -->
        <script>
            // Back to top functionality
            (function() {
                const backToTopButton = document.getElementById('back-to-top');
                const scrollThreshold = 300;
                
                function toggleBackToTop() {
                    if (window.scrollY > scrollThreshold) {
                        backToTopButton.style.display = 'block';
                    } else {
                        backToTopButton.style.display = 'none';
                    }
                }
                
                function scrollToTop() {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                }
                
                window.addEventListener('scroll', toggleBackToTop);
                backToTopButton.addEventListener('click', scrollToTop);
            })();
            
            // Clean up redundant spans in code blocks
            document.querySelectorAll('pre code').forEach(codeBlock => {
                // Find all line spans
                const lineSpans = codeBlock.querySelectorAll('span[id^="cb"]');
                
                lineSpans.forEach(lineSpan => {
                    // Check if this line has nested spans that can be simplified
                    const children = Array.from(lineSpan.childNodes);
                    
                    // Skip the anchor link (first child is usually the line number anchor)
                    let contentStart = 0;
                    if (children[0] && children[0].tagName === 'A') {
                        contentStart = 1;
                    }
                    
                    // If there's only one span child after the anchor, unwrap it
                    const contentChildren = children.slice(contentStart);
                    if (contentChildren.length === 1 && contentChildren[0].tagName === 'SPAN') {
                        const spanChild = contentChildren[0];
                        // Move the span's contents directly to the line span
                        while (spanChild.firstChild) {
                            lineSpan.insertBefore(spanChild.firstChild, spanChild);
                        }
                        // Remove the now-empty span
                        spanChild.remove();
                    }
                });
            });
            
            // Code copy functionality
            document.querySelectorAll('pre code').forEach(block => {
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.textContent = 'Copy';
                button.setAttribute('aria-label', 'Copy code to clipboard');
                
                button.addEventListener('click', function() {
                    navigator.clipboard.writeText(block.textContent).then(() => {
                        button.textContent = 'Copied!';
                        setTimeout(() => button.textContent = 'Copy', 2000);
                    }).catch(() => {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = block.textContent;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        button.textContent = 'Copied!';
                        setTimeout(() => button.textContent = 'Copy', 2000);
                    });
                });
                
                const pre = block.parentNode;
                pre.style.position = 'relative';
                pre.appendChild(button);
            });
        </script>
    </body>
</html>
